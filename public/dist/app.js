"use strict";require(["esri/Map","esri/views/MapView","esri/layers/VectorTileLayer","esri/Basemap","esri/layers/Layer","esri/layers/GraphicsLayer","esri/WebMap","esri/Graphic","esri/widgets/Expand","esri/core/watchUtils","dojo/on","dojo/dom","dojo/domReady!"],function(e,t,o,n,i,r,a,s,c,d,l,u){var p=void 0,m=void 0,y=new r,f=void 0,v=void 0,h=void 0,w=void 0,b=new e({basemap:new n({baseLayers:[new o({url:"http://www.arcgis.com/sharing/rest/content/items/2557730096db4d2fa3e64980d431c29e/resources/styles/root.json?f=pjson"})],title:"Custom Basemap",id:"myBasemap"})});b.add(y);var g=new a({portalItem:{id:"22ef9d1f8d9e49e6920f0c4e0643113a"}}),I=new t({container:"mapEditing",map:b,zoom:3,center:[17,50]}),E=new t({container:"mapHeatmap",map:g,zoom:3,center:[17,50]});function k(e){j();var t=p.applyEdits(e);t.then(function(e){if(0<e.addFeatureResults.length){var t=e.addFeatureResults.map(function(e){return e.objectId}),o=t[0];F(o)}}).catch(function(e){console.log("==============================================="),console.error("[ applyEdits ] FAILURE: ",e.code,e.name,e.message),console.log("error = ",e)})}function F(e){var t={type:"simple-marker",color:[0,0,0,0],style:"square",size:"40px",outline:{color:[0,255,255,1],width:"3px"}},o=p.createQuery();o.where=p.objectIdField+" = "+e,p.queryFeatures(o).then(function(e){0<e.features.length&&((v=e.features[0]).symbol=t,I.graphics.add(v))})}function j(){h.style.display="none",w.style.display="block",I.graphics.removeAll()}i.fromPortalItem({portalItem:{id:"30ae9d12f10e407a8c1b2df7c72b7d46"}}).then(function(e){p=e,b.add(e)}).catch(function(e){console.log("Layer failed to load: ",e)}),f=u.byId("editArea"),w=u.byId("updateInstructionDiv"),h=u.byId("featureUpdateDiv"),l(u.byId("btnAddFeature"),"click",function(){j(),l.once(I,"click",function(e){if(e.stopPropagation(),e.mapPoint){var t=e.mapPoint.clone();t.z=void 0,t.hasZ=!1;var o=new s({geometry:t,attributes:{}}),n=new s({geometry:t,symbol:{type:"simple-marker",style:"circle",color:"red",size:"17px",outline:{color:[255,255,255],width:1}}});y.add(n);var i={addFeatures:[o]};k(i),h.style.display="block",w.style.display="none",u.byId("mapEditing").style.cursor="auto"}else console.error("event.mapPoint is not defined")}),u.byId("mapEditing").style.cursor="crosshair",f.style.cursor="auto"}),l(u.byId("btnDelete"),"click",function(){var e={deleteFeatures:[v]};k(e)}),m=new c({expandIconClass:"esri-icon-edit",expandTooltip:"Expand Edit",expanded:!0,view:I,content:f}),I.ui.add(m,"top-right"),I.on("click",function(e){j(),I.hitTest(e).then(function(e){1<e.results.length&&e.results[0].graphic&&(F(e.results[0].graphic.attributes[p.objectIdField]),h.style.display="block",w.style.display="none")})});[I,E].map(function(e,t,o){var n=o.concat();return n.splice(t,1),function(t,o){var n,i,r,a;o=Array.isArray(o)?o:[o];var s=function(){r&&r.forEach(function(e){e.remove()}),n&&n.remove(),i&&i.remove(),a&&clearTimeout(a),r=n=i=a=null},e=t.watch("interacting,animation",function(e){e&&(n||a||(a=setTimeout(function(){a=null,n=t.watch("viewpoint",function(t){o.forEach(function(e){e.viewpoint=t})})},0),r=o.map(function(e){return d.watch(e,"interacting,animation",function(e){e&&s()})}),i=d.whenTrue(t,"stationary",s)))});return{remove:function(){this.remove=function(){},s(),e.remove()}}}(e,n)}),d.when(I,"scale",function(){y.removeAll()})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiTWFwIiwiTWFwVmlldyIsIlZlY3RvclRpbGVMYXllciIsIkJhc2VtYXAiLCJMYXllciIsIkdyYXBoaWNzTGF5ZXIiLCJXZWJNYXAiLCJHcmFwaGljIiwiRXhwYW5kIiwid2F0Y2hVdGlscyIsIm9uIiwiZG9tIiwiZmVhdHVyZUxheWVyIiwiZWRpdEV4cGFuZCIsImdyYXBoaWNzTGF5ZXIiLCJlZGl0QXJlYSIsImVkaXRGZWF0dXJlIiwiYXR0cmlidXRlRWRpdGluZyIsInVwZGF0ZUluc3RydWN0aW9uRGl2IiwibWFwRWRpdGluZyIsInZpZXdFZGl0aW5nIiwibWFwSGVhdG1hcCIsImJhc2VtYXAiLCJwb3J0YWxJdGVtIiwiaWQiLCJtYXAiLCJjZW50ZXIiLCJ6b29tIiwiY29udGFpbmVyIiwidGhlbiIsImFkZExheWVyIiwic2V0dXBFZGl0aW5nIiwiYXBwbHlFZGl0cyIsInBhcmFtcyIsInVuc2VsZWN0RmVhdHVyZSIsInByb21pc2UiLCJlZGl0c1Jlc3VsdCIsImV4dHJhY3RPYmplY3RJZCIsImNhdGNoIiwiZXJyb3IiLCJhZGRGZWF0dXJlUmVzdWx0cyIsImxlbmd0aCIsImFkZHMiLCJyZXN1bHQiLCJvYmplY3RJZCIsIm5ld0luY2lkZW50SWQiLCJzZWxlY3RGZWF0dXJlIiwiaGl0VGVzdCIsImV2ZW50IiwiY29uc29sZSIsImNvZGUiLCJuYW1lIiwicmVzcG9uc2UiLCJyZXN1bHRzIiwiZmVhdHVyZSIsImZlYXR1cmVzIiwic3ltYm9sIiwiY29sb3IiLCJzdHlsZSIsInNpemUiLCJvdXRsaW5lIiwid2lkdGgiLCJkaXNwbGF5IiwiZ3JhcGhpY3MiLCJyZW1vdmVBbGwiLCJzZWxlY3Rpb25TeW1ib2wiLCJhZGQiLCJ2aWV3IiwiY29udGVudCIsImxheWVyIiwidmlld3BvaW50V2F0Y2hIYW5kbGUiLCJieUlkIiwibmV3SW5jaWRlbnQiLCJnZW9tZXRyeSIsInBvaW50IiwidHlwZSIsImNsb25lIiwieiIsInVuZGVmaW5lZCIsImhhc1oiLCJhdHRyaWJ1dGVzIiwibmV3R3JhcGhpYyIsImVkaXRzIiwiY3Vyc29yIiwiYWRkRmVhdHVyZXMiLCJkZWxldGVGZWF0dXJlcyIsIm90aGVySW50ZXJhY3RIYW5kbGVycyIsInNjaGVkdWxlSWQiLCJleHBhbmRJY29uQ2xhc3MiLCJleHBhbmRUb29sdGlwIiwiZXhwYW5kZWQiLCJncmFwaGljIiwib2JqZWN0SWRGaWVsZCIsInZpZXdIZWF0bWFwIiwiaWR4Iiwidmlld3MiLCJvdGhlcnMiLCJjb25jYXQiLCJzcGxpY2UiLCJpbnRlcmFjdFdhdGNoZXIiLCJ3YXRjaCIsInZpZXdTdGF0aW9uYXJ5SGFuZGxlIiwibmV3VmFsdWUiLCJjbGVhciIsImZvckVhY2giLCJoYW5kbGUiLCJyZW1vdmUiLCJjbGVhclRpbWVvdXQiLCJzZXRUaW1lb3V0Iiwib3RoZXJWaWV3Iiwidmlld3BvaW50Iiwic3luY2hyb25pemVWaWV3cyIsInN5bmNocm9uaXplVmlldyIsImgiLCJ3aGVuVHJ1ZSIsInRoaXMiLCJ3aGVuIl0sIm1hcHBpbmdzIjoiYUFBQUEsUUFBUSxDQUNKLFdBREpBLHFCQUdJLDhCQWVBLGVBQUEsb0JBQ0EsNEJBQ0EsY0FDQSxlQUFBLHNCQUFBLHVCQUFBLFVBVEEsV0FXQSxrQkFDQSxTQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUNBQyxFQUNBQyxFQUFBQyxHQUVBLElBQUFDLE9BQUFBLEVBQUFDLE9BQUFBLEVBQ0FDLEVBQUEsSUFBQVQsRUFFQVUsT0FBQUEsRUFBQUMsT0FBQUEsRUFBQUMsT0FBQUEsRUFBQUMsT0FBQUEsRUFlTUMsRUFBYSxJQUFJbkIsRUFBSSxDQVdyQm9CLFFBakJnQixJQUFJakIsRUFBUSxDQVc1QmtCLFdBQUFBLENBTEFGLElBQWFqQixFQUFRLENBQ3ZCb0IsSUFBQUEsMEhBS0FDLE1BQUFBLGlCQUNJQyxHQUFBQSxnQkFNSkMsRUFBS04sSUFBQUEsR0FFTE8sSUFBQUEsRUFBUSxJ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LFdBQUEsV0FDS3JCLEVBQUEsS0FDSmpCLEVBQTZCSCxFQUE3QmlDLE1BQUEsWUFDQUcsU0FBQUEsR0FDQUosRUFBZ0JPLFFBQWhCLFNBQUFHLEdBQ0hBLEVBQUFDLFVBQUFSLE9BeEJNLEdBR0hoQixFQUF3QlUsRUFBT3ZFLElBQUksU0FBVW9GLEdBNEJyREUsT0FBbUJ0RyxFQUFuQnNHLE1BQUFBLEVBQ2NoQix3QkFDTkMsU0FDVUYsR0FDUGtCLEdBSFhULFFBVVlVLEVBQUF4RyxFQUFBeUcsU0FBQS9DLEVBREosYUFBQW9DLE9BSEQsTUFBUCxDQVBKRyxPQUFBLFdBVllTLEtBQUtULE9BQVMsYUE0QjFCSCxJQUNBUSxFQUFrQjNGLFdBZkg0RixDQUFnQjdDLEVBQU02QixLQWtCckN2RixFQUFXMkcsS0FBS2hHLEVBQWEsUUFBUyxXQUVsQ04sRUFBY2tEIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoW1xyXG4gICAgXCJlc3JpL01hcFwiLFxyXG4gICAgXCJlc3JpL3ZpZXdzL01hcFZpZXdcIixcclxuICAgIFwiZXNyaS9sYXllcnMvVmVjdG9yVGlsZUxheWVyXCIsXHJcbiAgICBcImVzcmkvQmFzZW1hcFwiLFxyXG4gICAgXCJlc3JpL2xheWVycy9MYXllclwiLFxyXG4gICAgXCJlc3JpL2xheWVycy9HcmFwaGljc0xheWVyXCIsXHJcbiAgICBcImVzcmkvV2ViTWFwXCIsXHJcbiAgICBcImVzcmkvR3JhcGhpY1wiLFxyXG4gICAgXCJlc3JpL3dpZGdldHMvRXhwYW5kXCIsXHJcbiAgICBcImVzcmkvY29yZS93YXRjaFV0aWxzXCIsXHJcbiAgICBcImRvam8vb25cIixcclxuICAgIFwiZG9qby9kb21cIixcclxuICAgIFwiZG9qby9kb21SZWFkeSFcIlxyXG5dLCBmdW5jdGlvbiAoTWFwLCBNYXBWaWV3LCBWZWN0b3JUaWxlTGF5ZXIsIEJhc2VtYXAsIExheWVyLCBHcmFwaGljc0xheWVyLCBXZWJNYXAsIEdyYXBoaWMsIEV4cGFuZCxcclxuICAgIHdhdGNoVXRpbHMsXHJcbiAgICBvbiwgZG9tKSB7XHJcblxyXG4gICAgbGV0IGZlYXR1cmVMYXllciwgZWRpdEV4cGFuZDtcclxuICAgIGxldCBncmFwaGljc0xheWVyID0gbmV3IEdyYXBoaWNzTGF5ZXIoKTtcclxuICAgIC8vIGZlYXR1cmUgZWRpdCBhcmVhIGRvbU5vZGVzXHJcbiAgICBsZXQgZWRpdEFyZWEsIGVkaXRGZWF0dXJlLCBhdHRyaWJ1dGVFZGl0aW5nLCB1cGRhdGVJbnN0cnVjdGlvbkRpdjtcclxuXHJcbiAgICAvLyBjb25zdCBzaW1wbGVSZW5kZXJlciA9IHtcclxuICAgIC8vICAgICB0eXBlOiBcInNpbXBsZVwiLCAgLy8gYXV0b2Nhc3RzIGFzIG5ldyBTaW1wbGVSZW5kZXJlcigpXHJcbiAgICAvLyAgICAgc3ltYm9sOiB7XHJcbiAgICAvLyAgICAgICAgIHR5cGU6IFwic2ltcGxlLW1hcmtlclwiLCAgLy8gYXV0b2Nhc3RzIGFzIG5ldyBTaW1wbGVNYXJrZXJTeW1ib2woKVxyXG4gICAgLy8gICAgICAgICBzaXplOiAxMixcclxuICAgIC8vICAgICAgICAgY29sb3I6IFwicmVkXCIsXHJcbiAgICAvLyAgICAgICAgIG91dGxpbmU6IHsgIC8vIGF1dG9jYXN0cyBhcyBuZXcgU2ltcGxlTGluZVN5bWJvbCgpXHJcbiAgICAvLyAgICAgICAgICAgICB3aWR0aDogMC41LFxyXG4gICAgLy8gICAgICAgICAgICAgY29sb3I6IFwid2hpdGVcIlxyXG4gICAgLy8gICAgICAgICB9XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gfTtcclxuXHJcbiAgICBjb25zdCB2dGxJdGVtID0gbmV3IFZlY3RvclRpbGVMYXllcih7XHJcbiAgICAgICAgdXJsOiBcImh0dHA6Ly93d3cuYXJjZ2lzLmNvbS9zaGFyaW5nL3Jlc3QvY29udGVudC9pdGVtcy8yNTU3NzMwMDk2ZGI0ZDJmYTNlNjQ5ODBkNDMxYzI5ZS9yZXNvdXJjZXMvc3R5bGVzL3Jvb3QuanNvbj9mPXBqc29uXCJcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHZlY3RvckJhc2VtYXAgPSBuZXcgQmFzZW1hcCh7XHJcbiAgICAgICAgYmFzZUxheWVyczogW3Z0bEl0ZW1dLFxyXG4gICAgICAgIHRpdGxlOiBcIkN1c3RvbSBCYXNlbWFwXCIsXHJcbiAgICAgICAgaWQ6IFwibXlCYXNlbWFwXCJcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBjb25zdCBtYXBFZGl0aW5nID0gbmV3IE1hcCh7XHJcbiAgICAgICAgYmFzZW1hcDogdmVjdG9yQmFzZW1hcFxyXG4gICAgfSk7XHJcbiAgICBtYXBFZGl0aW5nLmFkZChncmFwaGljc0xheWVyKTtcclxuXHJcbiAgICBjb25zdCBtYXBIZWF0bWFwID0gbmV3IFdlYk1hcCh7XHJcbiAgICAgICAgcG9ydGFsSXRlbToge1xyXG4gICAgICAgICAgICBpZDogXCIyMmVmOWQxZjhkOWU0OWU2OTIwZjBjNGUwNjQzMTEzYVwiXHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3Qgdmlld0VkaXRpbmcgPSBuZXcgTWFwVmlldyh7XHJcbiAgICAgICAgY29udGFpbmVyOiBcIm1hcEVkaXRpbmdcIiwgIFxyXG4gICAgICAgIG1hcDogbWFwRWRpdGluZywgIFxyXG4gICAgICAgIHpvb206IDMsICBcclxuICAgICAgICBjZW50ZXI6IFsxNywgNTBdICBcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHZpZXdIZWF0bWFwID0gbmV3IE1hcFZpZXcoe1xyXG4gICAgICAgIGNvbnRhaW5lcjogXCJtYXBIZWF0bWFwXCIsXHJcbiAgICAgICAgbWFwOiBtYXBIZWF0bWFwLFxyXG4gICAgICAgIHpvb206IDMsXHJcbiAgICAgICAgY2VudGVyOiBbMTcsIDUwXSAgXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBhZGQgYW4gZWRpdGFibGUgZmVhdHVyZWxheWVyIGZyb20gcG9ydGFsXHJcbiAgICBMYXllci5mcm9tUG9ydGFsSXRlbSh7XHJcbiAgICAgICAgcG9ydGFsSXRlbTogeyAvLyBhdXRvY2FzdHMgYXMgbmV3IFBvcnRhbEl0ZW0oKVxyXG4gICAgICAgICAgICBpZDogXCIzMGFlOWQxMmYxMGU0MDdhOGMxYjJkZjdjNzJiN2Q0NlwiXHJcbiAgICAgICAgfVxyXG4gICAgfSkudGhlbihhZGRMYXllcilcclxuICAgICAgICAgICAgLmNhdGNoKGhhbmRsZUxheWVyTG9hZEVycm9yKTtcclxuXHJcbiAgICBzZXR1cEVkaXRpbmcoKTtcclxuICAgIHNldHVwVmlldygpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGFkZExheWVyKGxheWVyKSB7XHJcbiAgICAgICAgZmVhdHVyZUxheWVyID0gbGF5ZXI7XHJcbiAgICAgICAgbWFwRWRpdGluZy5hZGQobGF5ZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGFwcGx5RWRpdHMocGFyYW1zKSB7XHJcbiAgICAgICAgdW5zZWxlY3RGZWF0dXJlKCk7XHJcbiAgICAgICAgbGV0IHByb21pc2UgPSBmZWF0dXJlTGF5ZXIuYXBwbHlFZGl0cyhwYXJhbXMpO1xyXG4gICAgICAgIGVkaXRSZXN1bHRzSGFuZGxlcihwcm9taXNlKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgLy8gYXBwbHlFZGl0cyBwcm9taXNlIHJlc29sdmVkIHN1Y2Nlc3NmdWxseVxyXG4gICAgLy8gcXVlcnkgdGhlIG5ld2x5IGNyZWF0ZWQgZmVhdHVyZSBmcm9tIHRoZSBmZWF0dXJlbGF5ZXJcclxuICAgIC8vIHNldCB0aGUgZWRpdEZlYXR1cmUgb2JqZWN0IHNvIHRoYXQgaXQgY2FuIGJlIHVzZWRcclxuICAgIC8vIHRvIHVwZGF0ZSBpdHMgZmVhdHVyZXMuXHJcbiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgZnVuY3Rpb24gZWRpdFJlc3VsdHNIYW5kbGVyKHByb21pc2UpIHtcclxuICAgICAgICBwcm9taXNlXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChlZGl0c1Jlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGV4dHJhY3RPYmplY3RJZCA9IGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Lm9iamVjdElkO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIG9iamVjdElkIG9mIHRoZSBuZXdseSBhZGRlZCBmZWF0dXJlXHJcbiAgICAgICAgICAgICAgICBpZiAoZWRpdHNSZXN1bHQuYWRkRmVhdHVyZVJlc3VsdHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBhZGRzID0gZWRpdHNSZXN1bHQuYWRkRmVhdHVyZVJlc3VsdHMubWFwKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHRyYWN0T2JqZWN0SWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBuZXdJbmNpZGVudElkID0gYWRkc1swXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0RmVhdHVyZShuZXdJbmNpZGVudElkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVwiKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJbIGFwcGx5RWRpdHMgXSBGQUlMVVJFOiBcIiwgZXJyb3IuY29kZSwgZXJyb3IubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBlcnJvci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgPSBcIiwgZXJyb3IpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgLy8gbGlzdGVuIHRvIGNsaWNrIGV2ZW50IG9uIHRoZSB2aWV3XHJcbiAgICAvLyAxLiBzZWxlY3QgaWYgdGhlcmUgaXMgYW4gaW50ZXJzZWN0aW5nIGZlYXR1cmVcclxuICAgIC8vIDIuIHNldCB0aGUgaW5zdGFuY2Ugb2YgZWRpdEZlYXR1cmVcclxuICAgIC8vIDMuIGVkaXRGZWF0dXJlIGlzIHRoZSBmZWF0dXJlIHRvIHVwZGF0ZSBvciBkZWxldGVcclxuICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICB2aWV3RWRpdGluZy5vbihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHVuc2VsZWN0RmVhdHVyZSgpO1xyXG4gICAgICAgIHZpZXdFZGl0aW5nLmhpdFRlc3QoZXZlbnQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAocmVzcG9uc2UucmVzdWx0cy5sZW5ndGggPiAxICYmIHJlc3BvbnNlLnJlc3VsdHNbMF0uZ3JhcGhpYykge1xyXG4gICAgICAgICAgICAgICAgbGV0IGZlYXR1cmUgPSByZXNwb25zZS5yZXN1bHRzWzBdLmdyYXBoaWM7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RGZWF0dXJlKGZlYXR1cmUuYXR0cmlidXRlc1tmZWF0dXJlTGF5ZXIub2JqZWN0SWRGaWVsZF0pO1xyXG5cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlRWRpdGluZy5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlSW5zdHJ1Y3Rpb25EaXYuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgLy8gc2VsZWN0IEZlYXR1cmUgZnVuY3Rpb25cclxuICAgIC8vIDEuIFNlbGVjdCB0aGUgbmV3bHkgY3JlYXRlZCBmZWF0dXJlIG9uIHRoZSB2aWV3XHJcbiAgICAvLyAyLiBvciBzZWxlY3QgYW4gZXhpc3RpbmcgZmVhdHVyZSB3aGVuIHVzZXIgY2xpY2sgb24gaXRcclxuICAgIC8vIDMuIFN5bWJvbGl6ZSB0aGUgZmVhdHVyZSB3aXRoIGN5YW4gcmVjdGFuZ2xlXHJcbiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgZnVuY3Rpb24gc2VsZWN0RmVhdHVyZShvYmplY3RJZCkge1xyXG4gICAgICAgIC8vIHN5bWJvbCBmb3IgdGhlIHNlbGVjdGVkIGZlYXR1cmUgb24gdGhlIHZpZXdcclxuICAgICAgICBsZXQgc2VsZWN0aW9uU3ltYm9sID0ge1xyXG4gICAgICAgICAgICB0eXBlOiBcInNpbXBsZS1tYXJrZXJcIiwgLy8gYXV0b2Nhc3RzIGFzIG5ldyBTaW1wbGVNYXJrZXJTeW1ib2woKVxyXG4gICAgICAgICAgICBjb2xvcjogWzAsIDAsIDAsIDBdLFxyXG4gICAgICAgICAgICBzdHlsZTogXCJzcXVhcmVcIixcclxuICAgICAgICAgICAgc2l6ZTogXCI0MHB4XCIsXHJcbiAgICAgICAgICAgIG91dGxpbmU6IHtcclxuICAgICAgICAgICAgICAgIGNvbG9yOiBbMCwgMjU1LCAyNTUsIDFdLFxyXG4gICAgICAgICAgICAgICAgd2lkdGg6IFwiM3B4XCJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgbGV0IHF1ZXJ5ID0gZmVhdHVyZUxheWVyLmNyZWF0ZVF1ZXJ5KCk7XHJcbiAgICAgICAgcXVlcnkud2hlcmUgPSBmZWF0dXJlTGF5ZXIub2JqZWN0SWRGaWVsZCArIFwiID0gXCIgKyBvYmplY3RJZDtcclxuXHJcbiAgICAgICAgZmVhdHVyZUxheWVyLnF1ZXJ5RmVhdHVyZXMocXVlcnkpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdHMpIHtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdHMuZmVhdHVyZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgZWRpdEZlYXR1cmUgPSByZXN1bHRzLmZlYXR1cmVzWzBdO1xyXG4gICAgICAgICAgICAgICAgZWRpdEZlYXR1cmUuc3ltYm9sID0gc2VsZWN0aW9uU3ltYm9sO1xyXG4gICAgICAgICAgICAgICAgdmlld0VkaXRpbmcuZ3JhcGhpY3MuYWRkKGVkaXRGZWF0dXJlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICAvLyBoaWRlIGF0dHJpYnV0ZXMgdXBkYXRlIGFuZCBkZWxldGUgcGFydCB3aGVuIG5lY2Vzc2FyeVxyXG4gICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgIGZ1bmN0aW9uIHVuc2VsZWN0RmVhdHVyZSgpIHtcclxuICAgICAgICBhdHRyaWJ1dGVFZGl0aW5nLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICB1cGRhdGVJbnN0cnVjdGlvbkRpdi5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG5cclxuICAgICAgICBcclxuICAgICAgICB2aWV3RWRpdGluZy5ncmFwaGljcy5yZW1vdmVBbGwoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgLy8gYWRkIGhvbWVCdXR0b24gYW5kIGV4cGFuZCB3aWRnZXRzIHRvIFVJXHJcbiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgZnVuY3Rpb24gc2V0dXBWaWV3KCkge1xyXG4gICAgICAgIC8vIGV4cGFuZCB3aWRnZXRcclxuICAgICAgICBlZGl0RXhwYW5kID0gbmV3IEV4cGFuZCh7XHJcbiAgICAgICAgICAgIGV4cGFuZEljb25DbGFzczogXCJlc3JpLWljb24tZWRpdFwiLFxyXG4gICAgICAgICAgICBleHBhbmRUb29sdGlwOiBcIkV4cGFuZCBFZGl0XCIsXHJcbiAgICAgICAgICAgIGV4cGFuZGVkOiB0cnVlLFxyXG4gICAgICAgICAgICB2aWV3OiB2aWV3RWRpdGluZyxcclxuICAgICAgICAgICAgY29udGVudDogZWRpdEFyZWFcclxuICAgICAgICB9KTtcclxuICAgICAgICB2aWV3RWRpdGluZy51aS5hZGQoZWRpdEV4cGFuZCwgXCJ0b3AtcmlnaHRcIik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgIC8vIHNldCB1cCBmb3IgZWRpdGluZ1xyXG4gICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgIGZ1bmN0aW9uIHNldHVwRWRpdGluZygpIHtcclxuICAgICAgICAvLyBpbnB1dCBib3hlcyBmb3IgdGhlIGF0dHJpYnV0ZSBlZGl0aW5nXHJcbiAgICAgICAgZWRpdEFyZWEgPSBkb20uYnlJZChcImVkaXRBcmVhXCIpO1xyXG4gICAgICAgIHVwZGF0ZUluc3RydWN0aW9uRGl2ID0gZG9tLmJ5SWQoXCJ1cGRhdGVJbnN0cnVjdGlvbkRpdlwiKTtcclxuICAgICAgICBhdHRyaWJ1dGVFZGl0aW5nID0gZG9tLmJ5SWQoXCJmZWF0dXJlVXBkYXRlRGl2XCIpO1xyXG4gICAgICAgIFxyXG5cclxuICAgICAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgICAgIC8vIGJ0bkFkZEZlYXR1cmUgY2xpY2sgZXZlbnRcclxuICAgICAgICAvLyBjcmVhdGUgYSBuZXcgZmVhdHVyZSBhdCB0aGUgY2xpY2sgbG9jYXRpb25cclxuICAgICAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgICAgIG9uKGRvbS5ieUlkKFwiYnRuQWRkRmVhdHVyZVwiKSwgXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHVuc2VsZWN0RmVhdHVyZSgpO1xyXG4gICAgICAgICAgICBvbi5vbmNlKHZpZXdFZGl0aW5nLCBcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50Lm1hcFBvaW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHBvaW50ID0gZXZlbnQubWFwUG9pbnQuY2xvbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBwb2ludC56ID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgICAgIHBvaW50Lmhhc1ogPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IG5ld0luY2lkZW50ID0gbmV3IEdyYXBoaWMoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZW9tZXRyeTogcG9pbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHt9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGxldCBuZXdHcmFwaGljID0gbmV3IEdyYXBoaWMoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZW9tZXRyeTogcG9pbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN5bWJvbDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzaW1wbGUtbWFya2VyXCIsICAvLyBhdXRvY2FzdHMgYXMgbmV3IFNpbXBsZU1hcmtlclN5bWJvbCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogXCJjaXJjbGVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBcInJlZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogXCIxN3B4XCIsICAvLyBwaXhlbHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dGxpbmU6IHsgIC8vIGF1dG9jYXN0cyBhcyBuZXcgU2ltcGxlTGluZVN5bWJvbCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IFsyNTUsIDI1NSwgMjU1XSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMSAgLy8gcG9pbnRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZ3JhcGhpY3NMYXllci5hZGQobmV3R3JhcGhpYyk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGVkaXRzID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRGZWF0dXJlczogW25ld0luY2lkZW50XVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGFwcGx5RWRpdHMoZWRpdHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHVpIGNoYW5nZXMgaW4gcmVzcG9uc2UgdG8gY3JlYXRpbmcgYSBuZXcgZmVhdHVyZVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRpc3BsYXkgZmVhdHVyZSB1cGRhdGUgYW5kIGRlbGV0ZSBwb3J0aW9uIG9mIHRoZSBlZGl0IGFyZWFcclxuICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVFZGl0aW5nLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlSW5zdHJ1Y3Rpb25EaXYuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGRvbS5ieUlkKFwibWFwRWRpdGluZ1wiKS5zdHlsZS5jdXJzb3IgPSBcImF1dG9cIjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcImV2ZW50Lm1hcFBvaW50IGlzIG5vdCBkZWZpbmVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIGNoYW5nZSB0aGUgdmlldydzIG1vdXNlIGN1cnNvciBvbmNlIHVzZXIgc2VsZWN0c1xyXG4gICAgICAgICAgICAvLyBhIG5ldyBpbmNpZGVudCB0eXBlIHRvIGNyZWF0ZVxyXG4gICAgICAgICAgICBkb20uYnlJZChcIm1hcEVkaXRpbmdcIikuc3R5bGUuY3Vyc29yID0gXCJjcm9zc2hhaXJcIjtcclxuICAgICAgICAgICAgZWRpdEFyZWEuc3R5bGUuY3Vyc29yID0gXCJhdXRvXCI7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICAgICAgLy8gZGVsZXRlIGJ1dHRvbiBjbGljayBldmVudC4gQXBwbHlFZGl0cyBpcyBjYWxsZWRcclxuICAgICAgICAvLyB3aXRoIHRoZSBzZWxlY3RlZCBmZWF0dXJlIHRvIGJlIGRlbGV0ZWRcclxuICAgICAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgICAgIG9uKGRvbS5ieUlkKFwiYnRuRGVsZXRlXCIpLCBcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgbGV0IGVkaXRzID0ge1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlRmVhdHVyZXM6IFtlZGl0RmVhdHVyZV1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgYXBwbHlFZGl0cyhlZGl0cyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGhhbmRsZUxheWVyTG9hZEVycm9yKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJMYXllciBmYWlsZWQgdG8gbG9hZDogXCIsIGVycm9yKTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgICAqIHV0aWxpdHkgbWV0aG9kIHRoYXQgc3luY2hyb25pemVzIHRoZSB2aWV3cG9pbnQgb2YgYSB2aWV3IHRvIG90aGVyIHZpZXdzXHJcbiAgICAgICAqL1xyXG4gICAgdmFyIHN5bmNocm9uaXplVmlldyA9IGZ1bmN0aW9uICh2aWV3LCBvdGhlcnMpIHtcclxuICAgICAgICBvdGhlcnMgPSBBcnJheS5pc0FycmF5KG90aGVycykgPyBvdGhlcnMgOiBbb3RoZXJzXTtcclxuXHJcbiAgICAgICAgdmFyIHZpZXdwb2ludFdhdGNoSGFuZGxlO1xyXG4gICAgICAgIHZhciB2aWV3U3RhdGlvbmFyeUhhbmRsZTtcclxuICAgICAgICB2YXIgb3RoZXJJbnRlcmFjdEhhbmRsZXJzO1xyXG4gICAgICAgIHZhciBzY2hlZHVsZUlkO1xyXG5cclxuICAgICAgICB2YXIgY2xlYXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChvdGhlckludGVyYWN0SGFuZGxlcnMpIHtcclxuICAgICAgICAgICAgICAgIG90aGVySW50ZXJhY3RIYW5kbGVycy5mb3JFYWNoKGZ1bmN0aW9uIChoYW5kbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBoYW5kbGUucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2aWV3cG9pbnRXYXRjaEhhbmRsZSAmJiB2aWV3cG9pbnRXYXRjaEhhbmRsZS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgdmlld1N0YXRpb25hcnlIYW5kbGUgJiYgdmlld1N0YXRpb25hcnlIYW5kbGUucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIHNjaGVkdWxlSWQgJiYgY2xlYXJUaW1lb3V0KHNjaGVkdWxlSWQpO1xyXG4gICAgICAgICAgICBvdGhlckludGVyYWN0SGFuZGxlcnMgPSB2aWV3cG9pbnRXYXRjaEhhbmRsZSA9XHJcbiAgICAgICAgICAgICAgICB2aWV3U3RhdGlvbmFyeUhhbmRsZSA9IHNjaGVkdWxlSWQgPSBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpbnRlcmFjdFdhdGNoZXIgPSB2aWV3LndhdGNoKCdpbnRlcmFjdGluZyxhbmltYXRpb24nLFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAobmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmICghbmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodmlld3BvaW50V2F0Y2hIYW5kbGUgfHwgc2NoZWR1bGVJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzdGFydCB1cGRhdGluZyB0aGUgb3RoZXIgdmlld3MgYXQgdGhlIG5leHQgZnJhbWVcclxuICAgICAgICAgICAgICAgIHNjaGVkdWxlSWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZUlkID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3cG9pbnRXYXRjaEhhbmRsZSA9IHZpZXcud2F0Y2goJ3ZpZXdwb2ludCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3RoZXJzLmZvckVhY2goZnVuY3Rpb24gKG90aGVyVmlldykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG90aGVyVmlldy52aWV3cG9pbnQgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0sIDApO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHN0b3AgYXMgc29vbiBhcyBhbm90aGVyIHZpZXcgc3RhcnRzIGludGVyYWN0aW5nLCBsaWtlIGlmIHRoZSB1c2VyIHN0YXJ0cyBwYW5uaW5nXHJcbiAgICAgICAgICAgICAgICBvdGhlckludGVyYWN0SGFuZGxlcnMgPSBvdGhlcnMubWFwKGZ1bmN0aW9uIChvdGhlclZpZXcpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2F0Y2hVdGlscy53YXRjaChvdGhlclZpZXcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdpbnRlcmFjdGluZyxhbmltYXRpb24nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBvciBzdG9wIHdoZW4gdGhlIHZpZXcgaXMgc3RhdGlvbmFyeSBhZ2FpblxyXG4gICAgICAgICAgICAgICAgdmlld1N0YXRpb25hcnlIYW5kbGUgPSB3YXRjaFV0aWxzLndoZW5UcnVlKHZpZXcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3N0YXRpb25hcnknLCBjbGVhcik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZW1vdmU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlID0gZnVuY3Rpb24gKCkgeyB9O1xyXG4gICAgICAgICAgICAgICAgY2xlYXIoKTtcclxuICAgICAgICAgICAgICAgIGludGVyYWN0V2F0Y2hlci5yZW1vdmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiB1dGlsaXR5IG1ldGhvZCB0aGF0IHN5bmNocm9uaXplcyB0aGUgdmlld3BvaW50cyBvZiBtdWx0aXBsZSB2aWV3c1xyXG4gICAgICovXHJcbiAgICB2YXIgc3luY2hyb25pemVWaWV3cyA9IGZ1bmN0aW9uICh2aWV3cykge1xyXG4gICAgICAgIHZhciBoYW5kbGVzID0gdmlld3MubWFwKGZ1bmN0aW9uICh2aWV3LCBpZHgsIHZpZXdzKSB7XHJcbiAgICAgICAgICAgIHZhciBvdGhlcnMgPSB2aWV3cy5jb25jYXQoKTtcclxuICAgICAgICAgICAgb3RoZXJzLnNwbGljZShpZHgsIDEpO1xyXG4gICAgICAgICAgICByZXR1cm4gc3luY2hyb25pemVWaWV3KHZpZXcsIG90aGVycyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlbW92ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUgPSBmdW5jdGlvbiAoKSB7IH07XHJcbiAgICAgICAgICAgICAgICBoYW5kbGVzLmZvckVhY2goZnVuY3Rpb24gKGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBoLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBoYW5kbGVzID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBiaW5kIHRoZSB2aWV3c1xyXG4gICAgc3luY2hyb25pemVWaWV3cyhbdmlld0VkaXRpbmcsIHZpZXdIZWF0bWFwXSk7XHJcblxyXG4gICAgLy8gV2F0Y2ggdmlldydzIHN0YXRpb25hcnkgcHJvcGVydHkgZm9yIGJlY29taW5nIHRydWUuXHJcbiAgICB3YXRjaFV0aWxzLndoZW4odmlld0VkaXRpbmcsIFwic2NhbGVcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8vIFJlbW92ZSBncmFwaGljcyBmcm9tIHRoZSBncmFwaGljcyBsYXllciBzbyB0aGF0IHJlYWwgZGF0YSBjYW4gYmUgc2VlblxyXG4gICAgICAgIGdyYXBoaWNzTGF5ZXIucmVtb3ZlQWxsKCk7XHJcbiAgICB9KTtcclxuICAgIFxyXG59KTsiXX0=
